%%%%%%%% ICML 2023 EXAMPLE LATEX SUBMISSION FILE %%%%%%%%%%%%%%%%%

\documentclass{article}

\usepackage[accepted]{icml2023}

% The \icmltitle you define below is probably too long as a header.
% Therefore, a short form for the running title is supplied here:
\icmltitlerunning{Project Report Template for Data Literacy 2023/24}

\begin{document}

\twocolumn[
\icmltitle{Influence of Weather Conditions on Solar Power Production}

% It is OKAY to include author information, even for blind
% submissions: the style file will automatically remove it for you
% unless you've provided the [accepted] option to the icml2023
% package.

% List of affiliations: The first argument should be a (short)
% identifier you will use later to specify author affiliations
% Academic affiliations should list Department, University, City, Region, Country
% Industry affiliations should list Company, City, Region, Country

% You can specify symbols, otherwise they are numbered in order.
% Ideally, you should not use this facility. Affiliations will be numbered
% in order of appearance and this is the preferred way.
\icmlsetsymbol{equal}{*}

\begin{icmlauthorlist}
	\icmlauthor{Leo Gönner}{equal,first}
	\icmlauthor{Sarah Hüwels}{equal,second}
	\icmlauthor{Julius Rau}{equal,third}
	\icmlauthor{Larissa Reichart}{equal,fourth}
\end{icmlauthorlist}

% fill in your matrikelnummer, email address, degree, for each group member
\icmlaffiliation{third}{Matrikelnummer 5441422, julius.rau@student.uni-tuebingen.de, MSc Machine Learning}
\icmlaffiliation{second}{Matrikelnummer 5473681, sarah.huewels@student.uni-tuebingen.de, MSc Medical Informatics}
\icmlaffiliation{first}{Matrikelnummer 6157373, leo.goenner@student.uni-tuebingen.de, MSc Mathematics}
\icmlaffiliation{fourth}{Matrikelnummer 6668873, larissa.reichart@student.uni-tuebingen.de, MSc Medical Informatics}

% You may provide any keywords that you
% find helpful for describing your paper; these are used to populate
% the "keywords" metadata in the PDF but will not be shown in the document
\icmlkeywords{Machine Learning, ICML}

\vskip 0.3in
]

% this must go after the closing bracket ] following \twocolumn[ ...

% This command actually creates the footnote in the first column
% listing the affiliations and the copyright notice.
% The command takes one argument, which is text to display at the start of the footnote.
% The \icmlEqualContribution command is standard text for equal contribution.
% Remove it (just {}) if you do not need this facility.

%\printAffiliationsAndNotice{}  % leave blank if no need to mention equal contribution
\printAffiliationsAndNotice{\icmlEqualContribution} % otherwise use the standard text.

\begin{abstract}
Put your abstract here. Abstracts typically start with a sentence motivating why the subject is interesting. Then mention the data, methodology or methods you are working with, and describe results. 
\end{abstract}

\section*{Structure}
\begin{enumerate}
	\item Intro: \begin{itemize}
		\item what are we doing and why
	\end{itemize}
	\item Methods\begin{enumerate}
		\item PV Cells 
		\item Interpolation
		\item Linear regression
		\item Lasso
	\end{enumerate}
	\item Data explanation \begin{itemize}
		\item DWD, stations and fields
		\item data measurement, PV system setup
	\end{itemize}
	\item Data sanity checks\begin{enumerate}
		\item PVGIS general production
		\item prod/h with manufacturer data\begin{itemize}
			\item Assumption: only sun can produce electricity
			\item show problems
			\item cloudy hours produce sunlight
			\item trying to model cloudy production
			\item still inaccuracies other influences
		\end{itemize}
	\end{enumerate}
	\item What influences the PV production\begin{enumerate}
		\item Scatter
		\item Solar Noon altitudes (what and why)
	\end{enumerate}
	\item Regression with Lasso\begin{enumerate}
		\item General model with SNA as prominent feature
		\item seasonal regression with better accuracy
		\item explain influences technically
		\item discussion aspects
	\end{enumerate}
\end{enumerate}


\section{Introduction}\label{sec:intro}
%Motivate the problem, situation or topic you decided to work on. Describe why it matters (is it of societal, economic, scientific value?). Outline the rest of the paper (use references, e.g.~to \Cref{sec:methods}: What kind of data you are working with, how you analyze it, and what kind of conclusion you reached. The point of the introduction is to make the reader want to read the rest of the paper.
More and more people put photovoltaic systems on their roofs. 
Most of these home systems are grid connected and people like to examine how much electricity they produce, consume and feed into the grid. This depends on many different factors.
In this work we are going to closely look at the electricity production of a single photovoltaic system and investigate how exactly these values are generated.
It is a long way from the manufacturers data to the actual measurements and in the process we will see the influences of weather, angle and orientation of the system and its location.
The influences of location, angle and orientation are relatively clear and that's why the main part of this work is to investigate the different weather influences.
By using inverted distance weighting interpolation and linear regression we are able to determine the most crucial factors to electricity production.
Since PV is well studied, none of these effects are unexpected for the system, and we give the physical explanations to the observed phenomenon.
This work can be seen as a general study of photovoltaic technology on the basis of a single photovoltaic system. 
\textbf{To-do: Explain achievements in this paper (explain the way from manufacturers data to actual measurements)}


\section{Methodology}
\subsection{Photovoltaic cells}\label{sec:pv}

Photovoltaic cells, also called solar cells, are key parts of solar panels which are widely used for electricity production. They can be used in devices like pocket calculators or be strung together to power houses or form industrial solar farms.\\

\begin{enumerate}
	\item Basic structure: \begin{itemize}
			\item solar cells are made of semiconductor materials, usually silicone
			\item the cell contains two layers of silicone, one with excess electrons and the other with missing electrons called holes
			\item the layers are therefore differently charged and form an electrical field
	\end{itemize}
	\item Photovoltaic effect: \begin{itemize}
		\item When photons hit the semiconductor material in the solar cell, they can dislodge electrons
		\item dislodged electrons leave a hole
		\item the electrons and holes now move directed by the electrical field to opposite sides of the silicone layer
	\end{itemize}
	\item Generation of electric current \begin{itemize}
		\item metal contacts are placed at both sides of the silicone and facilitate the electrical flow
		\item the electrons at one side can now flow through the wire into the holes at the other side of the silicone
		\item this creates an electrical circuit
	\end{itemize}
\end{enumerate}
The electrical circuit created by the solar cells can now be used just like any other. Solar cells include other building blocks like an anti-reflective surface, a protective glass screen and more \citep{SolarCells}.

\subsection{Inverse distance weighting}
Inverse distance weighting (IDW) is an interpolation method commonly used for the interpolation of weather data, such as solar radiation \cite{Loghmari2018} , temperature \cite{Cao2009}  and rainfall \cite{Chen2012}. 
It relies on the premise, that points close to an unmeasured location have more influence on the predictive outcome than those points with a greater distance \cite{Chen2012}. 
Consequently, nearby points receive a higher weight during the interpolation than points that are further away \cite{Lu2008}. 
The IDW formula is defined as
\begin{align}
    \hat{Z} = \sum_{i=1}^N w_iR_i \\
    w_i = \frac{d_i^{-\alpha}}{\sum_{i=1}^N{d_i^{-\alpha}}}
\end{align} \cite{Chen2012},
 where $\hat{Z}$ is the unknown data point, $w_i$ is the weight for a station i, $Z_i$ is the measured data of a location i, $d_i$ is the distance between the known and unknown location and $\alpha$ is the power. 
 A large $\alpha$ yields larger weights for the nearest points \cite{Lu2008}.

\subsection{Linear Regression and Lasso}
We assume familiarity with multiple linear regression. Lasso (acronym for least absolute shrinkage and selection operator) is a widely used regularization method. It penalizes large feature weights by incorporating the $L_1$-norm of the weight vector into the loss function. Let $X$ be the feature matrix, where each column is standardized and let $y$ contain the centered values of the response variable. The Lasso chooses the weight vector $w$ according to
\begin{equation*}
	w = \underset{w}{\text{arg\,min}} \, \frac{1}{2n} \|y - Xw\|_2^2 + \alpha \|w\|_1.
\end{equation*}
The obtained model then maps a new input $x$ to $\langle x,w \rangle + \bar{y}$. The advantage of linear regression with Lasso compared to standard linear regression or ridge regression is that it enforces sparsity of the weights. Hence, Lasso acts as a feature selection method and improves interpretability of the model, both of which are crucial aspects for our use case: Many of the weather features we obtained are highly correlated and we are aiming to find explanations for solar electricity production rather than creating an accurate model for predicting production based on weather conditions.


\section{Data collection}
We are using two different data sources. One source is the alternating-current converter of the PV system which measures the incoming electricity and makes the data available daily.
This converter has been collecting data for the last 5 years. The device is called \textit{Symo 6.0-3-M} and is made by Fronius.
The data on weather comes from the German weather service (Deutscher Wetter Dienst, DWD).
\subsection{The PV system}
The system we are investigating is located in Fürstenfeldbruck, Germany and is composed of 22 IBC MonoSol 310 VL5 solar panels \cite{MonoSol}.
The array consists of 22 solar modules with a maximum power output (Pmax) of 310 Watts under standard testing conditions and 227.8 W  under Nominal Operating Cell Temperature (NOCT).
It sits at 10$^\circ$ inclination, has an orientation of -110 $^\circ$ and elevation of 528 m.
\begin{figure*}
	\includegraphics[draft]{fig/outlier_scatter.pdf}
	\caption{Test}
\end{figure*}

\subsection{Weather data}
The DWD provides an open data area from the climate data center \cite{CDC}. 
For this project, we retrieved daily climate data from different weather stations in Germany for the years 2019 to 2022. 
The datasets include features like daily rainfall in mm (RF), daily duration of sunshine in hours (DS) and daily mean of the air-temperature at a height of 2 meters in °C (AT). 
For information on all features check the README.md file in the repository. \\ 
We created two datasets that can be used for analysis, one containing the data of one weather station located in Munich (48.1632, 11.5429) and one containing interpolated data. For the interpolation we chose three weather stations surrounding the PV system in Fürstenfeldbruck (48.1825, 11.2474). 
One station is located in Munich (48.1632, 11.5429), 22,2km away from the PV system, the second station is located in Augsburg (48.4253, 10.9417) with a distance of 35,2km and the third station is in Kaufbeuren-Oberbeuren (47.8761, 10.5849) which has a distance of 59,9km to the PV system. 
We set the power parameter $\alpha$ to 1 and interpolated the data using IDW to predict the weather data at the location of the PV system. We interpolated the three features RF, DS and AT for this project.

\section{Data sanity checks}\label{sec:methods}

\subsection{Comparison with expected energy production}

We validated data plausibility by comparing it with estimates from the European Union's Photovoltaic Geographical Information System (PVGIS) (TODO: CITE), which calculates PV system output based specified location, technology, peak power, slope, orientation, and system losses. Solar radiation is estimated from satellite images for the calculation.

PVGIS corrects for various effects impacting energy production, including topographical features, shallow light reflection, material sensitivity to sunlight wavelengths, module temperature, and user-specified system losses. The latter accounts for cable losses, inverter losses, dust, dirt, and an annual efficiency decrease. A recommended value of 14\% is suggested. However, since our data is collected at the inverter and does not include inverter losses, we chose value of 11 \% to avoid underestimating the output.

The PVGIS output provides an annual average PV production for the specified system of $6112.89$ kWh$ \pm 295.04$ kWh. Our data is within the estimated range, except for 2022, where the production exceeded expectations. We attribute this to a sunnier year (\textbf{CITE}) which is also evident in our weather data. In winter, actual production is lower than the monthly estimates, likely due to snow covering the modules and blocking sunlight, and the fact that PVGIS does not model snow. In contrast, summer production exceeded estimates, consistent with normal year-to-year variability due to weather conditions. Overall, our data is consistent with expectations.

\subsection{Production per hour of sunshine}

The manufacturer of the PV system specifies an output of 0.31 kWh per module under optimal standard testing conditions (\textbf{CITE}). While real-world conditions rarely match these optimal standards and slightly higher production than the maximum peak is possible, they provide a reasonable threshold for comparison and sanity checks. Each day's total production is divided by the reported hours of sunshine and the number of modules, i.e. 22, resulting in energy production per module per hour of sunshine.

This calculation yields a mean production of 0.37 kWh ± 1.85 kWh, appearing unrealistic when compared to the normal peak of 0.31 kWh, with particularly high variability between days. Further investigation focuses on 230 outlier days (out of 1461 total days) where production exceeds 0.31 kWh. The mean production on these outlier days is remarkably high, reaching 1.77 kWh, more than five times the maximum peak, with one day even reaching an implausible value of 38.18 kWh per hour. Analyzing the remaining days without outliers reveals a mean production of 0.11 kWh ± 0.07 kWh. This seems plausible, considering variations due to different weather conditions on different days and the expectation that most days have worse conditions than standard test conditions.

An unrealistic peak in production per hour can be caused by either too few hours of sunshine or too much production. Examining the total production of the PV system along with the hours of sunshine on outlier days shows that the total production falls within the lower to middle range of all data, suggesting plausibility (\textbf{SEE PLOT}). However, a general pattern emerges: outlier days tend to occur mostly on days with few hours of sunshine, resulting in an unrealistically high quotient when considering normal production.

One potential explanation for this pattern is inaccurate weather data. Hours of sunshine are measured at a weather station \textbf{XX} km away from the PV system's location, where local weather conditions may differ significantly. To address this, data from different weather stations are used, and weather features are interpolated using inverse distance weighting. \textbf{Plot } illustrates the production per hour and module, as well as hours of sunshine, for both the original and interpolated weather data. While interpolation smoothes out unrealistic spikes for some days, it doesn't consistently improve the situation because it also introduces new spikes. This may be because the additional weather stations are even farther away. This limits their ability to accurately reflect the local weather.

A second aspect is that simply dividing total production by sunshine hours assumes energy production only in direct sunlight, ignoring radiation reaching the modules during cloud cover. The assumption aligns with a reported median cloud cover of 7.7 out of 8, indicating significant cloudiness. Assuming that a PV system can achieve around 5\% (\textbf{CITE}) of its maximum efficiency during cloud cover, we model cloud-induced production as the product of efficiency, daylight hours, and maximum system production ($0.31 $kWh$ \cdot 22$). While this is a simplified estimate, it is useful for assessing the plausibility of the data when considering cloud-induced production. Cloud production explains 91 of the 230 outlier days. On 115 days, unrealistic peaks still persist, and on 24 days, cloud production is overestimated. Similar outcomes are observed with interpolated weather data, indicating that the interpolation method might not be fully effective due to the increased distance of additional weather stations. 

While many observations align with explanations, it is evident that the energy production by the PV system is a complex mixture beyond just sun and clouds. Peaks in production per hour can be attributed to inaccuracies and the neglect of cloud-induced production, although not every peak can be fully explained.

%In this section, describe \emph{what you did}. Roughly speaking, explain what data you worked with, how or from where it was collected, it's structure and size. Explain your analysis, and any specific choices you made in it. Depending on the nature of your project, you may focus more or less on certain aspects. If you collected data yourself, explain the collection process in detail. If you downloaded data from the net, show an exploratory analysis that builds intuition for the data, and shows that you know the data well. If you are doing a custom analysis, explain how it works and why it is the right choice. If you are using a standard tool, it may still help to briefly outline it. Cite relevant works. You can use the \verb|\citep| and \verb|\citet| commands for this purpose \citep{mackay2003information}.

% This is the template for a figure from the original ICML submission pack. In lecture 10 we will discuss plotting in detail.
% Refer to this lecture on how to include figures in this text.
% 
% \begin{figure}[ht]
% \vskip 0.2in
% \begin{center}
% \centerline{\includegraphics[width=\columnwidth]{icml_numpapers}}
% \caption{Historical locations and number of accepted papers for International
% Machine Learning Conferences (ICML 1993 -- ICML 2008) and International
% Workshops on Machine Learning (ML 1988 -- ML 1992). At the time this figure was
% produced, the number of accepted papers for ICML 2008 was unknown and instead
% estimated.}
% \label{icml-historical}
% \end{center}
% \vskip -0.2in
% \end{figure}


\section{Analysis}

%In this section outline your results. At this point, you are just stating the outcome of your analysis. You can highlight important aspects (``we observe a significantly higher value of $x$ over $y$''), but leave interpretation and opinion to the next section. This section absolutely \emph{has} to include at least two figures.


\section{Conclusion}

%Use this section to briefly summarize the entire text. Highlight limitations and problems, but also make clear statements where they are possible and supported by the analysis. 


\section*{Contribution Statement}

%Explain here, in one sentence per person, what each group member contributed. For example, you could write: Max Mustermann collected and prepared data. Gabi Musterfrau and John Doe performed the data analysis. Jane Doe produced visualizations. All authors will jointly wrote the text of the report. Note that you, as a group, a collectively responsible for the report. Your contributions should be roughly equal in amount and difficulty.

%Your entire report has a \textbf{hard page limit of 4 pages} excluding references. (I.e. any pages beyond page 4 must only contain references). Appendices are \emph{not} possible. But you can put additional material, like interactive visualizations or videos, on a GitHub repo (use \href{https://github.com/pnkraemer/tueplots}{links} in your PDF to refer to them). Each report has to contain \textbf{at least three plots or visualizations}, and \textbf{cite at least two references}. More details about how to prepare the report, including how to produce plots, cite correctly, and how to ideally structure your GitHub repo, will be discussed in the lecture, where a rubric for the evaluation will also be provided.

\bibliographystyle{icml2023}
\bibliography{bibliography}

\end{document}


% This document was modified from the file originally made available by
% Pat Langley and Andrea Danyluk for ICML-2K. This version was created
% by Iain Murray in 2018, and modified by Alexandre Bouchard in
% 2019 and 2021 and by Csaba Szepesvari, Gang Niu and Sivan Sabato in 2022.
% Modified again in 2023 by Sivan Sabato and Jonathan Scarlett.
% Previous contributors include Dan Roy, Lise Getoor and Tobias
% Scheffer, which was slightly modified from the 2010 version by
% Thorsten Joachims & Johannes Fuernkranz, slightly modified from the
% 2009 version by Kiri Wagstaff and Sam Roweis's 2008 version, which is
% slightly modified from Prasad Tadepalli's 2007 version which is a
% lightly changed version of the previous year's version by Andrew
% Moore, which was in turn edited from those of Kristian Kersting and
% Codrina Lauth. Alex Smola contributed to the algorithmic style files.
