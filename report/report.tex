%%%%%%%% ICML 2023 EXAMPLE LATEX SUBMISSION FILE %%%%%%%%%%%%%%%%%

\documentclass{article}

\usepackage[accepted]{icml2023}
\usepackage{url}
\def\UrlBreaks{\do\/\do-\do\&\do.\do:}

% The \icmltitle you define below is probably too long as a header.
% Therefore, a short form for the running title is supplied here:
\icmltitlerunning{Project Report Template for Data Literacy 2023/24}

\begin{document}

\twocolumn[
\icmltitle{Influence of Weather Conditions on Solar Power Production}

% It is OKAY to include author information, even for blind
% submissions: the style file will automatically remove it for you
% unless you've provided the [accepted] option to the icml2023
% package.

% List of affiliations: The first argument should be a (short)
% identifier you will use later to specify author affiliations
% Academic affiliations should list Department, University, City, Region, Country
% Industry affiliations should list Company, City, Region, Country

% You can specify symbols, otherwise they are numbered in order.
% Ideally, you should not use this facility. Affiliations will be numbered
% in order of appearance and this is the preferred way.
\icmlsetsymbol{equal}{*}

\begin{icmlauthorlist}
	\icmlauthor{Leo Gönner}{equal,first}
	\icmlauthor{Sarah Hüwels}{equal,second}
	\icmlauthor{Julius Rau}{equal,third}
	\icmlauthor{Larissa Reichart}{equal,fourth}
\end{icmlauthorlist}

% fill in your matrikelnummer, email address, degree, for each group member
\icmlaffiliation{third}{Matrikelnummer 5441422, julius.rau@student.uni-tuebingen.de, MSc Machine Learning}
\icmlaffiliation{second}{Matrikelnummer 5473681, sarah.huewels@student.uni-tuebingen.de, MSc Medical Informatics}
\icmlaffiliation{first}{Matrikelnummer 6157373, leo.goenner@student.uni-tuebingen.de, MSc Mathematics}
\icmlaffiliation{fourth}{Matrikelnummer 6668873, larissa.reichart@student.uni-tuebingen.de, MSc Medical Informatics}

% You may provide any keywords that you
% find helpful for describing your paper; these are used to populate
% the "keywords" metadata in the PDF but will not be shown in the document
\icmlkeywords{Machine Learning, ICML}

\vskip 0.3in
]

% this must go after the closing bracket ] following \twocolumn[ ...

% This command actually creates the footnote in the first column
% listing the affiliations and the copyright notice.
% The command takes one argument, which is text to display at the start of the footnote.
% The \icmlEqualContribution command is standard text for equal contribution.
% Remove it (just {}) if you do not need this facility.

%\printAffiliationsAndNotice{}  % leave blank if no need to mention equal contribution
\printAffiliationsAndNotice{\icmlEqualContribution} % otherwise use the standard text.

\begin{abstract}
Put your abstract here. Abstracts typically start with a sentence motivating why the subject is interesting. Then mention the data, methodology or methods you are working with, and describe results. 
\end{abstract}

\section{Introduction}\label{sec:intro}
%Motivate the problem, situation or topic you decided to work on. Describe why it matters (is it of societal, economic, scientific value?). Outline the rest of the paper (use references, e.g.~to \Cref{sec:methods}: What kind of data you are working with, how you analyze it, and what kind of conclusion you reached. The point of the introduction is to make the reader want to read the rest of the paper.
More and more people install photovoltaic systems on their roofs. 
Most of these home systems are grid connected and the amount of produced and consumed electricity can be examined, as well as hoch much electricity is fed into the grid.
This depends on many different factors.
In this work we are going to closely look at the electricity production of a single photovoltaic system and investigate how exactly these values are generated.
It is a long way from the manufacturers data to the actual measurements and in the process we will see the influences of weather, angle, location and orientation of the system on the generated electricity.
The influences of angle, location and orientation are well known, so the main part of this work is to investigate the different weather influences.
By using inverted distance weighting interpolation and linear regression we are able to determine the most crucial factors to electricity production.
Additionally, we will give the physical explanations to the observed phenomenons and describe the way from the manufacturers data to the actual measurements.
This work can be seen as a general study of photovoltaic technology on the basis of a single photovoltaic system. 

\section{Methodology}
\subsection{Photovoltaic cells}\label{sec:pv}

Photovoltaic cells, also called solar cells, are key parts of solar panels which are widely used for electricity production. They can be used in devices like pocket calculators or be strung together to power houses or form industrial solar farms.\\

\begin{enumerate}
	\item Basic structure: \begin{itemize}
			\item solar cells are made of semiconductor materials, usually silicone
			\item the cell contains two layers of silicone, one with excess electrons and the other with missing electrons called holes
			\item the layers are therefore differently charged and form an electrical field
	\end{itemize}
	\item Photovoltaic effect: \begin{itemize}
		\item When photons hit the semiconductor material in the solar cell, they can dislodge electrons
		\item dislodged electrons leave a hole
		\item the electrons and holes now move directed by the electrical field to opposite sides of the silicone layer
	\end{itemize}
	\item Generation of electric current \begin{itemize}
		\item metal contacts are placed at both sides of the silicone and facilitate the electrical flow
		\item the electrons at one side can now flow through the wire into the holes at the other side of the silicone
		\item this creates an electrical circuit
	\end{itemize}
\end{enumerate}
The electrical circuit created by the solar cells can now be used just like any other. Solar cells include other building blocks like an anti-reflective surface, a protective glass screen and more \citep{SolarCells}.

\subsection{Inverse distance weighting}
Inverse distance weighting (IDW) is an interpolation method commonly used for the interpolation of weather data, such as solar radiation \cite{Loghmari2018} , temperature \cite{Cao2009}  and rainfall \cite{Chen2012}. 
It relies on the premise, that points close to an unmeasured location have more influence on the predictive outcome than those points with a greater distance \cite{Chen2012}. 
Consequently, nearby points receive a higher weight during the interpolation than points that are further away \cite{Lu2008}. 
The IDW formula is defined as
\begin{align}
    \hat{Z} = \sum_{i=1}^N w_iR_i \\
    w_i = \frac{d_i^{-\alpha}}{\sum_{i=1}^N{d_i^{-\alpha}}}
\end{align} \cite{Chen2012},
 where $\hat{Z}$ is the unknown data point, $w_i$ is the weight for a station i, $Z_i$ is the measured data of a location i, $d_i$ is the distance between the known and unknown location and $\alpha$ is the power. 
 A large $\alpha$ yields larger weights for the nearest points \cite{Lu2008}.

\subsection{Linear regression and LASSO}
We assume familiarity with multiple linear regression. LASSO (acronym for least absolute shrinkage and selection operator) is a widely used regularization method. It penalizes large feature weights by incorporating the $L_1$-norm of the weight vector into the loss function. Let $X$ be the feature matrix, where each column is standardized and let $y$ contain the centered values of the response variable. Choose $\alpha > 0$. The LASSO chooses the weight vector $w$ according to
\begin{equation*}
	w = \underset{w}{\text{arg\,min}} \, \frac{1}{2n} \|y - Xw\|_2^2 + \alpha \|w\|_1.
\end{equation*}
Inputs x are then mapped to $\langle x, w \rangle + \bar{y}$ by the obtained model. The advantage of using linear regression with LASSO, as
opposed to standard linear regression or ridge regression, is that it enforces sparsity of the weights. This means that LASSO acts as a feature selection method, which improves interpretability. This is crucial for our use case, since our goal is to find explanations for solar electricity production rather than creating an accurate model for predicting production based on weather conditions.


\section{Data collection}
We are using two different data sources. One source is the alternating-current converter of the PV system which measures the incoming electricity and makes the data available daily.
This converter has been collecting data for the last 5 years. The device is called \textit{Symo 6.0-3-M} and is made by Fronius.
The data on weather comes from the German weather service (Deutscher Wetter Dienst, DWD).
\subsection{The PV system}
The system we are investigating is located in Fürstenfeldbruck, Germany and is composed of 22 IBC MonoSol 310 VL5 solar panels \cite{MonoSol}.
The array consists of 22 solar modules with a maximum power output (Pmax) of 310 Watts under standard testing conditions and 227.8 W  under Nominal Operating Cell Temperature (NOCT).
It sits at 10° inclination, has an orientation of -110° and elevation of 528 m.


\subsection{Weather data}
The DWD provides an open data area from the climate data center \cite{CDC}. 
For this project, we retrieved daily climate data from different weather stations in Germany for the years 2019 to 2022. 
The datasets include features like daily rainfall in mm, daily duration of sunshine in hours and daily mean of the air-temperature at a height of 2 meters in °C. 
For information on all features check the README.md file in the repository. \\ 
We created two datasets for the analysis, one containing the data of one weather station located in Munich (48.1632, 11.5429) and one containing interpolated data. For the interpolation we chose three weather stations surrounding the PV system in Fürstenfeldbruck (48.1825, 11.2474). 
One station is located in Munich (48.1632, 11.5429), 22,2km away from the PV system, the second station is located in Augsburg (48.4253, 10.9417) with a distance of 35,2km and the third station is in Kaufbeuren-Oberbeuren (47.8761, 10.5849) which has a distance of 59,9km to the PV system. 
We set the power parameter $\alpha$ to 1 and interpolated the data using IDW to predict the weather data at the location of the PV system. We interpolated the three features rainfall, hours of sunshine and temperature for this project.

\section{Data sanity checks}\label{sec:methods}

\subsection{Comparison with expected energy production}

We validated data plausibility by comparing it to estimates from the European Union's Photovoltaic Geographical Information System (PVGIS) (TODO: CITE). It is important to note that the data is collected at the inverter and does not represent the energy delivered to the grid. So it does not include inverter losses, and we took that into account in the system specification for the estimate.

The annual production is within the estimated range ($6112.89$ kWh$ \pm 295.04$ kWh), except for 2022, where the production exceeded expectations. We attribute this to a sunnier year (\textbf{CITE}) which is also evident in our weather data. In winter, actual production is lower than the monthly estimates, likely due to snow covering the modules and blocking sunlight, and the fact that PVGIS does not model snow. In contrast, summer production exceeded estimates, but was in line with normal year-to-year variability due to weather conditions.

\subsection{Production per hour of sunshine}

\begin{figure}
	\includegraphics{fig/outlier_scatter.pdf}
	\caption{Outlier scatter plot}\label{fig:outlier_scatter}
\end{figure}
\begin{figure}
	\includegraphics{fig/prod_per_sunhour.pdf}
	\caption{TODO}
\end{figure}

The manufacturer of the PV system specifies an output of 0.31 kWh per module under optimal standard testing conditions (\textbf{CITE}). While real-world conditions rarely match these and slightly higher production than the maximum peak is possible, they provide a reasonable threshold for sanity checks. Therefore, we calculated the energy production per module per hour of sunshine for each day.

This results in an unrealistic average with particularly high variability between days ($0.37$ kWh $\pm 1.85$ kWh). The average production per hour on the 230 days, that exceed the plausibility threshold of 0.31 kWh, is remarkably high at 1.77 kWh, while the total production on these days seems plausible. It can be observed that they tend to occur on days with few hours of sunshine. (\textbf{PLOT}).  The remaining non-outlier days have a mean (0.11 $\pm$ 0.07 kWh) within expectations, considering that most days have worse conditions than the standard test conditions. 

Possible explanations could be inaccurate weather data, resulting in too few sunshine hours, and neglecting possible energy production during cloud cover, resulting in an overestimation of sunlight production. To better estimate sun hours at the system's location we interpolated weather features using inverse distance weighting. While interpolation smooths out unrealistic spikes for some days, it does not consistently improve the problem because it also introduces new spikes. (\textbf{PLOT}). This may be because the additional weather stations are even farther away limiting their ability to accurately reflect the local weather. We modeled cloud-induced production in a very simplified way as the product of daylight hours and $5\%$ efficiency of maximum system production. This improved the problem for some days, but not all. It also showed that the estimate was too simplistic and probably overestimated cloud-induced production.


\section{Analysis}
To gain a better understanding of the factors that influence power generation in the analyzed PV system, we take a closer look at \ref{fig:outlier_scatter}. Instead of coloring days with implausible production per hour of sunshine, we group days by the month they lie in. Since (on the northern hemisphere) the summer solstice happens roughly in the middle of June, the same color is assigned to each pair of months that are equidistant from June.

\begin{figure}
	\includegraphics{fig/scatter.pdf}
	\caption{Scatter plot}\label{fig:scatter_months}
\end{figure}

As anticipated, \ref{fig:scatter_months} shows that production per hour of sunshine is largest in May, June and July and smallest in November, December and January. North of the Tropic of Cancer the sun reaches its maximum height close to the June solstice, which always lies around June 21st. A larger solar angle results in more photons per area reaching earths surface and less solar radiation being absorbed by the atmosphere. Since the solar cells inclination is 10° and the maximum height of the sun is below 80° in Fürstenfeldbruck, the suns angle with respect to the solar cells is most favorable around the June solstice. The insight that larger solar angles increase power production motivates the introduction of solar noon altitudes as additional feature. The solar noon altitude for each day is defined as the altitude the sun reaches at solar noon, i.e. the maximum azimuth of the sun for each day.

Using the solar noon altitudes and all quantitative attributes obtained from the DWD weather stations, we train a linear regression model. To increase interpretability and to eliminate some of the highly correlated weather features, we use the LASSO with a relatively large regularization parameter of $\alpha = 0.5$. The fitted model has a mean squared error of 12.3 over the years 2019 to 2022. As shown in \ref{fig:predictions}, the models fluctuations are too high in winter and too low in summer.

\begin{figure}
	\includegraphics{fig/predictions.pdf}
	\caption{Fitted models}\label{fig:predictions}
\end{figure}

To mitigate this problem, we train four new linear regression models using the LASSO, one for each astronomical season. The astronomical seasons are defined via the duration of sunshine, see \cite{MS}. As shown in \ref{fig:predictions}, the four models provide a significantly better fit to the observed production data, resulting in a reduced overall mean squared error of 7.5.

\ref{fig:coefficients} depicts the learned feature weights of the four seasonal models. Features which received a weight of zero in each model are omitted. As expected, the sunshine duration has relatively large weights in all four models. In the summer model, the weight for the solar noon altitudes is much less dominant than in spring and fall. This could be due to a much larger variability of the solar noon altitudes around the equinoxes in spring and fall. According to our models, mean humidity and vapor pressure do have a negative impact on solar power production. Water vapor absorbs and scatters sunlight, which reduces the irradiance. This phenomenon could explain the observed effect. Increasing temperatures tend to decrease the efficiency of solar cells, as outlined in \cite{SolarAndTemperature}. However, our models were unable to validate these findings. Perhaps the effects are not significant enough and are hindered by the fact that high temperatures tend to be correlated with high irradiance.

\begin{figure}
	\includegraphics{fig/regression.pdf}
	\caption{Each model was trained using the LASSO with $\alpha = 0.5$ on all days which belong to the respective astronomical season and lie between 2019 and 2022.}\label{fig:coefficients}
\end{figure}

The main limitation of our models is that they assume linear relationships between weather features and solar power production. This is a significant simplification, which may explain the shortcomings of the model trained on all data discussed in the context of \ref{fig:predictions}.

\subsection*{Regression impact technical reason}
\begin{itemize}
	\item Sunshine: more sunshine more photons hitting the cells $\rightarrow$ more electricity
	\item Angle: angle closer to 90° means more photons hitting a smaller area. Which means more photons per square centimeter and more electricity
	\item Snow: snow covers the solar modules and blocks light
	\item Temperature: temperature has an effect on various parameters in solar cells, but increasing temperatures tend to decrease the overall performance \cite{SolarAndTemperature}
	\item Vapor Pressure: related concepts
	\item Humidity: Water vapor can absorb and scatter sunlight, affecting the irradiance. Humidity also affects the air temperature. 
	Sufficient condensation of water on the cells leads to deposits of dirt and dust. \cite{SolarAndHumidity} investigates all of these effects and more
\end{itemize}
\section{Conclusion}

%Explain here, in one sentence per person, what each group member contributed. For example, you could write: Max Mustermann collected and prepared data. Gabi Musterfrau and John Doe performed the data analysis. Jane Doe produced visualizations. All authors will jointly wrote the text of the report. Note that you, as a group, a collectively responsible for the report. Your contributions should be roughly equal in amount and difficulty.
\section*{Structure}
\begin{enumerate}
	\item Intro: \begin{itemize}
		\item what are we doing and why
	\end{itemize}
	\item Methods\begin{enumerate}
		\item PV Cells 
		\item Interpolation
		\item Linear regression
		\item LASSO
	\end{enumerate}
	\item Data explanation \begin{itemize}
		\item DWD, stations and fields
		\item data measurement, PV system setup
	\end{itemize}
	\item Data sanity checks\begin{enumerate}
		\item PVGIS general production
		\item prod/h with manufacturer data\begin{itemize}
			\item Assumption: only sun can produce electricity
			\item show problems
			\item cloudy hours produce sunlight
			\item trying to model cloudy production
			\item still inaccuracies other influences
		\end{itemize}
	\end{enumerate}
	\item What influences the PV production\begin{enumerate}
		\item Scatter
		\item Solar Noon altitudes (what and why)
	\end{enumerate}
	\item Regression with LASSO\begin{enumerate}
		\item General model with SNA as prominent feature
		\item seasonal regression with better accuracy
		\item explain influences technically
		\item discussion aspects
	\end{enumerate}
\end{enumerate}

\bibliographystyle{icml2023}
\bibliography{bibliography}

\end{document}


% This document was modified from the file originally made available by
% Pat Langley and Andrea Danyluk for ICML-2K. This version was created
% by Iain Murray in 2018, and modified by Alexandre Bouchard in
% 2019 and 2021 and by Csaba Szepesvari, Gang Niu and Sivan Sabato in 2022.
% Modified again in 2023 by Sivan Sabato and Jonathan Scarlett.
% Previous contributors include Dan Roy, Lise Getoor and Tobias
% Scheffer, which was slightly modified from the 2010 version by
% Thorsten Joachims & Johannes Fuernkranz, slightly modified from the
% 2009 version by Kiri Wagstaff and Sam Roweis's 2008 version, which is
% slightly modified from Prasad Tadepalli's 2007 version which is a
% lightly changed version of the previous year's version by Andrew
% Moore, which was in turn edited from those of Kristian Kersting and
% Codrina Lauth. Alex Smola contributed to the algorithmic style files.
